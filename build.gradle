import aQute.bnd.gradle.Bndrun

plugins {
    id 'org.jetbrains.kotlin.jvm' apply false
    id 'biz.aQute.bnd.builder'
}

def VERSION = "1.0"

version = VERSION

allprojects {
    repositories {
        mavenCentral()
    }
}

subprojects {
    version = VERSION
    apply plugin: 'org.jetbrains.kotlin.jvm'
    apply plugin: 'biz.aQute.bnd.builder'
    compileKotlin {
        kotlinOptions {
            apiVersion = "1.4"
            languageVersion = "1.4"
            jvmTarget = "11"
        }
    }
}

configurations {
    bundles
}

dependencies {
    runtimeOnly "org.jetbrains.kotlin:kotlin-osgi-bundle:$kotlinVersion"
    runtimeOnly "org.apache.felix:org.apache.felix.framework:$felixVersion"
    bundles project('bundles:A')
    bundles project('bundles:B')
}

tasks.register('run', Bndrun) {
    inputs.files(configurations.runtimeClasspath, configurations.bundles)
    bundles = configurations.runtimeClasspath + configurations.bundles
    bndrun = 'bndrun'
}